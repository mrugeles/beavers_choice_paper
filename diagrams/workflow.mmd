flowchart LR
    %% Defining Styles for visual clarity
    classDef agent fill:#e1f5fe,stroke:#01579b,stroke-width:2px;
    classDef tool fill:#fff9c4,stroke:#fbc02d,stroke-width:2px,color:#000;
    classDef term fill:#ffebee,stroke:#c62828,stroke-width:2px;

    %% Starting Point
    Start(Quote Request) --> QA1
    Tool0[Tool]:::tool
    A[Agent]:::agent
    %% --- Phase 1: Request & Check ---
    QA1[Quote Agent]:::agent <--> Tool1[Structure<br/>Request]:::tool
    QA1 --> IA1[Inventory Agent]:::agent

    IA1 <--> Tool2[Check<br/>Stock]:::tool
    IA1 --> Decision1{Stock<br/>Status}

    %% Decision 1 Branches
    Decision1 -- No Stock --> End1[End]:::term
    Decision1 -- "Delivery > Requested" --> End2[End]:::term
    Decision1 -- Stock OK --> IA2[Inventory Agent]:::agent

    %% --- Phase 2: Transaction & Quote ---
    IA2 --> Tool3[Sales<br/>Transaction]:::tool
    IA2 --> QA2[Quote Agent]:::agent

    QA2 --> Tool4[Create<br/>Quote]:::tool

    %% --- Phase 3: Re-Check & Order (The bottom line of your drawing) ---
    QA2 --> IA3[Inventory Agent]:::agent

    IA3 <--> Tool5[Check<br/>Stock]:::tool
    IA3 --> Decision2{Stock<br/>Available?}

    %% Decision 2 Branches
    Decision2 -- Yes --> End3[End]:::term
    Decision2 -- No --> IA4[Inventory Agent]:::agent

    %% Final Step
    IA4 --> Tool6[Stock Order<br/>Transaction]:::tool
    IA4 --> EndFinal[End]:::term