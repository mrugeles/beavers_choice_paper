flowchart TB
    classDef orchestrator fill:#f9f,stroke:#333,stroke-width:2px
    classDef agent fill:#bbf,stroke:#333,stroke-width:2px
    classDef tool fill:#e1f5fe,stroke:#333,stroke-width:1px,stroke-dasharray: 5 5
    classDef db fill:#fff9c4,stroke:#d4e157,stroke-width:2px

 subgraph OrchestratorScope["Orchestrator Agent Scope"]
        Orch["<b>OrchestratorAgent</b><br>Responsibility: Manage workflow lifecycle<br>and delegate tasks."]
  end
 subgraph QuoteScope["Quote Agent Scope"]
        QuoteAgent["<b>QuoteAgent</b><br>Responsibility: Parse NLP<br>and calculate pricing."]
        ToolStructureRequest("<b>Tool: structure_request</b><br><b>Purpose:</b> Parse unstructured text into structured JSON<br>with delivery deadline, item names, and quantities<br><b>Input:</b> raw_text [str], current_date [str]<br><b>Output:</b> JSON Dict [items, deadline]")
        LLMCall(["LLM Call"])
        ToolStructureRequestError1["Could not process quote request"]
        ToolGetQuoteHistory("<b>Tool: get_quote_history</b><br><b>Purpose:</b> Search historical quotes based on<br>item names to inform pricing<br><b>Input:</b> item_name [str]<br><b>Output:</b> List[Dict] [past prices]")
        search_quote_history(["search_quote_history"])
        ToolCalculateQuote("<b>Tool: calculate_quote</b><br><b>Purpose:</b> Generate final price with discounts and<br>friendly rounding based on structured request and historical quotes<br><b>Input:</b> structured_request [Dict], historical_quotes [list]<br><b>Output:</b> Final Quote [dict]")
        LLMCall1(["LLM Call"])
        ToolCalculateQuoteError1["Could not calculate quote"]
  end
 subgraph InventoryScope["Inventory Agent Scope"]
        InventoryAgent["<b>InventoryAgent</b><br>Responsibility: Check stock<br>and execute transactions."]
        ToolCheckItemStock("<b>Tool: check_item_stock</b><br><b>Purpose:</b> Query current stock level, unit price,<br>and min_stock_level for a specific item<br><b>Input:</b> item_name [str], as_of_date [str]<br><b>Output:</b> Stock Info [dict]")
        get_stock_level(["get_stock_level"])
        ToolCheckItemStockError1["Could not process quote due to insufficient stock"]
        ToolOrderItemStock("<b>Tool: order_item_stock</b><br><b>Purpose:</b> Record sales or stock_orders<br>transactions in the database<br><b>Helper:</b> create_transaction<br><b>Input:</b> item_name, quantity, price, type<br><b>Output:</b> Transaction Status [dict]")
        create_transaction(["create_transaction"])

  end
    UserRequest(["User Request: Raw Text + Date"]) --> Orch
    ToolStructureRequest --> LLMCall
    ToolStructureRequest --Parsing fail---> ToolStructureRequestError1
    ToolGetQuoteHistory -. Search Terms.-> search_quote_history
    search_quote_history -- Query DB --- DB
    ToolCalculateQuote --> LLMCall1
    ToolCalculateQuote --Quote calculation fails---> ToolCalculateQuoteError1
    ToolCheckItemStock -. Item Info .-> get_stock_level
    ToolOrderItemStock --Transaction Object---> create_transaction
    Orch -- "1. Send Raw Text" --> QuoteAgent
    QuoteAgent -. Plain Text Quote Request.-> ToolStructureRequest
    QuoteAgent -. Search Terms.-> ToolGetQuoteHistory
    QuoteAgent -. JSON Request / History.-> ToolCalculateQuote
    ToolStructureRequest -. Quote Request JSON.-> QuoteAgent
    QuoteAgent -- Return structured request --> Orch
    Orch -- "2. Check items" --> InventoryAgent
    InventoryAgent -. Item Info .-> ToolCheckItemStock
    InventoryAgent -. Transaction Object .-> ToolOrderItemStock
    ToolCheckItemStock -- Query DB --- DB[("<b>SQLite Database</b><br>Tables: inventory, transactions")]
    ToolCheckItemStock -. Stock Item Info .-> InventoryAgent
    ToolCheckItemStock --Stock is insufficient---> ToolCheckItemStockError1
    InventoryAgent -- Return Stock Status --> Orch
    Orch -- "3. Request History" --> QuoteAgent
    ToolGetQuoteHistory -. Quote History .-> QuoteAgent
    ToolCalculateQuote -. Quote .-> QuoteAgent
    QuoteAgent -- Return Final Quote --> Orch
    Orch -- "4. Process Sales" --> InventoryAgent
    ToolOrderItemStock -- Insert Sales Record --- DB
    Orch -- "5. Restock if needed" --> InventoryAgent
    ToolOrderItemStock -- Insert Stock Order --- DB
    ToolOrderItemStock -. Transaction ID .-> InventoryAgent
    InventoryAgent -- Confirm Success --> Orch
    Orch --> FinalResponse(["Return Final Quote to User"])


     Orch:::orchestrator
     QuoteAgent:::agent
     ToolStructureRequest:::tool
     ToolGetQuoteHistory:::tool
     ToolCalculateQuote:::tool
     InventoryAgent:::agent
     ToolCheckItemStock:::tool
     ToolOrderItemStock:::tool
     DB:::db
